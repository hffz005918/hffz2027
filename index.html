<!DOCTYPE html>
<html lang="zh-CN" data-platform="desktop">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 预加载关键资源 -->
    <link rel="preconnect" href="//static.example.com">
    <link rel="preload" as="image" href="/img/bg-mobile.webp" media="(max-width: 600px)">
    <link rel="preload" as="image" href="/img/bg.avif" media="(min-width: 601px)">

    <!-- 内联核心CSS -->
    <style>
        /*! core.css */
        :root {
            --color-primary: #2c5e8f;
            --color-surface: #fff;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: system-ui, -apple-system;
            line-height: 1.5;
            background: var(--color-primary);
        }

        .app-shell {
            min-height: 100vh;
            display: grid;
            grid-template-rows: auto 1fr;
        }

        .nav-card {
            background: var(--color-surface);
            border-radius: 8px;
            padding: 1rem;
            margin: 0.75rem;
            box-shadow: var(--shadow-sm);
        }

        @media (max-width: 600px) {
            :root {
                --shadow-sm: none;
            }
            
            .nav-card {
                padding: 0.75rem;
                margin: 0.5rem;
            }
        }
    </style>

    <!-- 异步加载增强CSS -->
    <link rel="stylesheet" href="/css/enhance.css" media="(min-width: 601px)" async>
    
    <title>员工服务系统</title>
</head>

<body>
    <div class="app-shell">
        <main>
            <div class="nav-cards">
                <div class="nav-card" data-route="/dorm">
                    <h2>宿舍管理</h2>
                    <p>管理制度查询</p>
                </div>
                <div class="nav-card" data-route="/fee">
                    <h2>费用查询</h2>
                    <p>电费查询服务</p>
                </div>
            </div>
        </main>
    </div>

    <!-- 智能背景加载 -->
    <picture class="bg-layer">
        <source srcset="/img/bg.avif" type="image/avif" media="(min-width: 601px)">
        <source srcset="/img/bg-mobile.webp" type="image/webp">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxIiBoZWlnaHQ9IjEiLz4=" 
             alt="背景" 
             loading="lazy"
             decoding="async">
    </picture>

    <!-- 核心JS -->
    <script>
        // 设备检测
        const isMobile = /Mobi|Android/i.test(navigator.userAgent);
        document.documentElement.dataset.platform = isMobile ? 'mobile' : 'desktop';

        // 即时交互
        document.addEventListener('DOMContentLoaded', () => {
            // 基础路由
            document.querySelectorAll('.nav-card').forEach(card => {
                card.onclick = () => {
                    window.location.href = card.dataset.route;
                };
            });

            // 按需加载
            if(isMobile) {
                import('/js/core.js').catch(() => {});
            } else {
                import('/js/enhance.js');
            }
        });

        // 智能Service Worker
        if('serviceWorker' in navigator && location.protocol === 'https:') {
            navigator.serviceWorker.register('/sw.js', {
                scope: '/',
                updateViaCache: 'none'
            });
        }
    </script>
</body>
</html>
