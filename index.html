<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    <!-- å¼ºåŒ–ç¼“å­˜æ§åˆ¶ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- æ‰‹æœºç«¯ä¼˜åŒ–æ ‡ç­¾ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- å¾®ä¿¡ä¼˜åŒ–æ ‡ç­¾ -->
    <meta name="x5-page-mode" content="app">
    <meta name="x5-orientation" content="portrait">
    <meta name="renderer" content="webkit">
    
    <!-- SEOä¼˜åŒ– -->
    <meta name="description" content="å®æ–¹çººç»‡å‘˜å·¥æœåŠ¡å¹³å°ï¼Œæä¾›å®¿èˆç®¡ç†ã€è´¹ç”¨æŸ¥è¯¢ã€å‘˜å·¥åé¦ˆç­‰æœåŠ¡">
    
    <title>å‘˜å·¥æœåŠ¡ç³»ç»Ÿ - å®æ–¹çººç»‡</title>

    <style>
        :root {
            --primary-color: #1890ff;
            --secondary-color: #1a73e8;
            --admin-color: #722ed1;
            --success-color: #52c41a;
            --feedback-color: #fa8c16;
            --wechat-color: #07c160;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-light: #ffffff;
            --text-dark: #333333;
            --text-secondary: #666666;
            --transition-speed: 0.3s;
            --border-radius: 12px;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --box-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: "Microsoft YaHei", "PingFang SC", system-ui, sans-serif;
            height: 100vh;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            background: linear-gradient(135deg, #6a8bad 0%, #4a6b8f 100%);
            line-height: 1.5;
            overflow-x: hidden;
            position: relative;
        }

        /* å¾®ä¿¡æµè§ˆå™¨æç¤ºæ¡† */
        .wechat-tip {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, var(--wechat-color) 0%, #0aad60 100%);
            color: #fff;
            z-index: 2000;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideDown 0.5s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .wechat-tip .tip-content {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            max-width: 800px;
            margin: 0 auto;
        }

        .wechat-tip .tip-text {
            font-size: clamp(0.9rem, 3vw, 1rem);
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .wechat-tip .tip-icon {
            font-size: 1.2rem;
            margin-right: 5px;
            vertical-align: middle;
        }

        .wechat-tip .tip-detail {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-top: 3px;
            display: block;
            width: 100%;
        }

        .wechat-tip .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
            margin-left: 10px;
            flex-shrink: 0;
        }

        .wechat-tip .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .wechat-tip .browser-icon {
            display: inline-block;
            margin: 0 5px;
            font-size: 1rem;
        }

        .background {
            position: fixed;
            width: 100%;
            height: 100%;
            background: no-repeat center/cover;
            filter: brightness(0.8);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .background.loaded {
            opacity: 1;
        }

        .content {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            animation: fadeInContent 0.5s ease 0.3s forwards;
        }

        /* å½“å¾®ä¿¡æç¤ºæ¡†æ˜¾ç¤ºæ—¶ï¼Œè°ƒæ•´å†…å®¹åŒºåŸŸä½ç½® */
        body.wechat-tip-visible .content {
            padding-top: 80px;
            height: calc(100vh - 60px);
        }

        .title {
            color: var(--text-light);
            text-align: center;
            margin-bottom: 3rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .title h1 {
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            margin-bottom: 0.8rem;
            font-weight: 500;
        }

        .title p {
            font-size: clamp(1rem, 3vw, 1.2rem);
            opacity: 0.9;
        }

        .nav-cards {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            width: min(90%, 800px);
            margin: 0 auto;
        }

        .nav-card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: 
                transform var(--transition-speed) ease,
                box-shadow var(--transition-speed) ease;
            box-shadow: var(--box-shadow);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-tap-highlight-color: transparent;
            position: relative;
            overflow: hidden;
        }

        .nav-card:focus-visible {
            box-shadow: 0 0 0 3px var(--secondary-color);
        }

        .nav-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--box-shadow-hover);
        }

        .nav-card:active {
            transform: translateY(-2px) scale(0.98);
        }

        .nav-card h2 {
            margin-bottom: 1rem;
            font-size: clamp(1.3rem, 4vw, 1.6rem);
            font-weight: 500;
        }

        .nav-card p {
            color: var(--text-secondary);
            font-size: clamp(0.9rem, 3vw, 1rem);
        }

        /* ä¸åŒå¡ç‰‡çš„é¢œè‰²ä¸»é¢˜ */
        .nav-card.dorm {
            border-top: 4px solid var(--primary-color);
        }

        .nav-card.dorm h2 {
            color: var(--primary-color);
        }

        .nav-card.fee {
            border-top: 4px solid var(--success-color);
        }

        .nav-card.fee h2 {
            color: var(--success-color);
        }

        .nav-card.feedback {
            border-top: 4px solid var(--feedback-color);
        }

        .nav-card.feedback h2 {
            color: var(--feedback-color);
        }

        .nav-card.admin {
            border-top: 4px solid var(--admin-color);
        }

        .nav-card.admin h2 {
            color: var(--admin-color);
        }

        /* ç®¡ç†å‘˜å¡ç‰‡ç‰¹æ®Šæ ·å¼ */
        .admin-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--admin-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .feature-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--feedback-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .wechat-loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-size: 1.1rem;
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
        }

        .loader-content {
            text-align: center;
            max-width: 80%;
        }

        .loader-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 1rem;
        }

        .mobile-status-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: env(safe-area-inset-top);
            background: transparent;
            z-index: 999;
        }

        /* å¾®ä¿¡ä¸“ç”¨æ ·å¼ - å¢å¼ºå…¼å®¹æ€§ */
        body.wechat-browser {
            background: linear-gradient(135deg, #6a8bad 0%, #4a6b8f 100%);
            -webkit-overflow-scrolling: touch;
        }
        
        body.wechat-browser .background {
            display: none;
        }
        
        /* å¾®ä¿¡ä¸­æ›´ä¿å®ˆçš„åŠ¨ç”»æ•ˆæœ */
        body.wechat-browser .nav-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        /* å¾®ä¿¡åŠ è½½å¤±è´¥æç¤º */
        .wechat-fallback {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1001;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .wechat-fallback button {
            margin-top: 20px;
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeInContent {
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .nav-cards {
                gap: 1.2rem;
                width: 95%;
            }
            
            .nav-card {
                padding: 1.5rem;
            }
            
            .title {
                margin-bottom: 2.5rem;
            }

            body {
                /* é˜²æ­¢ç§»åŠ¨ç«¯ç¼©æ”¾ */
                touch-action: manipulation;
                -webkit-text-size-adjust: 100%;
            }

            /* å¾®ä¿¡æç¤ºæ¡†ä¼˜åŒ– */
            .wechat-tip {
                padding: 12px 15px;
            }
            
            .wechat-tip .tip-content {
                gap: 8px;
            }
            
            .wechat-tip .tip-text {
                font-size: 0.9rem;
            }
            
            .wechat-tip .tip-detail {
                font-size: 0.75rem;
            }
            
            body.wechat-tip-visible .content {
                padding-top: 70px;
                height: calc(100vh - 50px);
            }
        }

        @media (max-width: 480px) {
            .nav-cards {
                grid-template-columns: 1fr;
            }

            .nav-card {
                padding: 1.2rem;
            }

            .title {
                margin-bottom: 2rem;
            }
            
            /* å°å±å¹•å¾®ä¿¡æç¤ºæ¡†ä¼˜åŒ– */
            .wechat-tip .tip-content {
                flex-direction: column;
                gap: 5px;
            }
            
            .wechat-tip .close-btn {
                position: absolute;
                top: 5px;
                right: 5px;
                width: 24px;
                height: 24px;
                font-size: 0.9rem;
            }
            
            .wechat-tip .tip-text {
                padding-right: 30px;
                text-align: left;
            }
            
            body.wechat-tip-visible .content {
                padding-top: 80px;
            }
        }

        @supports not (backdrop-filter: blur(5px)) {
            .nav-card {
                background: rgba(255, 255, 255, 0.98);
            }
            
            .wechat-loader {
                background: rgba(0, 0, 0, 0.85);
            }
            
            .wechat-tip {
                background: linear-gradient(135deg, #07c160 0%, #0aad60 100%);
            }
        }

        /* é˜²æ­¢iOSæ©¡çš®ç­‹æ•ˆæœè¿‡åº¦æ»šåŠ¨ */
        body.ios-scroll-fix {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <!-- å¾®ä¿¡æµè§ˆå™¨æç¤ºæ¡† -->
    <div class="wechat-tip" id="wechatTip" aria-live="polite">
        <div class="tip-content">
            <span class="tip-text">
                <span class="tip-icon">ğŸ“±</span>
                æ£€æµ‹åˆ°æ‚¨åœ¨å¾®ä¿¡å†…æ‰“å¼€ï¼Œå»ºè®®ä½¿ç”¨æ‰‹æœºæµè§ˆå™¨è®¿é—®ä»¥è·å¾—æ›´å¥½ä½“éªŒ
                <span class="tip-detail">éƒ¨åˆ†åŠŸèƒ½åœ¨å¾®ä¿¡ä¸­å¯èƒ½å—é™ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’"..."é€‰æ‹©"åœ¨æµè§ˆå™¨æ‰“å¼€"</span>
            </span>
            <button class="close-btn" id="closeWechatTip" aria-label="å…³é—­æç¤º">Ã—</button>
        </div>
    </div>
    
    <div class="mobile-status-bar"></div>
    
    <!-- å¾®ä¿¡åŠ è½½å¤±è´¥æç¤º -->
    <div class="wechat-fallback" id="wechatFallback">
        <h3>é¡µé¢åŠ è½½å¤±è´¥</h3>
        <p>æŠ±æ­‰ï¼Œé¡µé¢åŠ è½½é‡åˆ°é—®é¢˜ã€‚è¯·å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š</p>
        <p>1. æ£€æŸ¥ç½‘ç»œè¿æ¥</p>
        <p>2. åˆ·æ–°é¡µé¢é‡è¯•</p>
        <p>3. æ¸…é™¤å¾®ä¿¡ç¼“å­˜åé‡è¯•</p>
        <button id="refreshButton">åˆ·æ–°é¡µé¢</button>
    </div>
    
    <div class="wechat-loader" id="wechatLoader" aria-live="polite">
        <div class="loader-spinner"></div>
        <div class="loader-content">
            <div id="loaderText">æ­£åœ¨åŠ è½½ï¼Œè¯·ç¨å€™...</div>
        </div>
    </div>

    <div class="background" id="background"></div>
    
    <div class="content">
        <div class="title">
            <h1>å‘˜å·¥æœåŠ¡ç³»ç»Ÿ</h1>
            <p>æ¬¢è¿ä½¿ç”¨å®æ–¹çººç»‡æœåŠ¡å¹³å°</p>
        </div>
        
        <div class="nav-cards" role="navigation">
            <!-- å®¿èˆç®¡ç† -->
            <div class="nav-card dorm" 
                 role="button" 
                 tabindex="0"
                 data-href="dorm-rules.html"
                 aria-labelledby="dorm-title"
                 aria-describedby="dorm-desc">
                <h2 id="dorm-title">å®¿èˆç®¡ç†</h2>
                <p id="dorm-desc">å‘˜å·¥å®¿èˆç®¡ç†åˆ¶åº¦ä¸è§„å®š</p>
            </div>
            
            <!-- è´¹ç”¨æŸ¥è¯¢ -->
            <div class="nav-card fee" 
                 role="button" 
                 tabindex="0"
                 data-href="fee-query.html"
                 aria-labelledby="fee-title"
                 aria-describedby="fee-desc">
                <h2 id="fee-title">è´¹ç”¨æŸ¥è¯¢</h2>
                <p id="fee-desc">æ°´ç”µè´¹ç”¨æŸ¥è¯¢ä¸ç¼´çº³æœåŠ¡</p>
            </div>
            
            <!-- å‘˜å·¥åé¦ˆç³»ç»Ÿ -->
            <div class="nav-card feedback" 
                 role="button" 
                 tabindex="0"
                 data-href="feedback.html"
                 aria-labelledby="feedback-title"
                 aria-describedby="feedback-desc">
                <div class="feature-badge">æ–°åŠŸèƒ½</div>
                <h2 id="feedback-title">å‘˜å·¥åé¦ˆ</h2>
                <p id="feedback-desc">æ„è§å»ºè®®ä¸é—®é¢˜åŒ¿ååé¦ˆ</p>
            </div>
            
            <!-- ç®¡ç†å‘˜å…¥å£ -->
            <div class="nav-card admin" 
                 role="button" 
                 tabindex="0"
                 data-href="admin-feedback.html"
                 aria-labelledby="admin-title"
                 aria-describedby="admin-desc">
                <div class="admin-badge">ç®¡ç†å‘˜</div>
                <h2 id="admin-title">åé¦ˆç®¡ç†</h2>
                <p id="admin-desc">æŸ¥çœ‹å’Œå¤„ç†å‘˜å·¥åé¦ˆä¿¡æ¯</p>
            </div>
        </div>
    </div>

    <script>
        // ç‰ˆæœ¬å· - æ¯æ¬¡æ›´æ–°æ—¶ä¿®æ”¹æ­¤ç‰ˆæœ¬å·å¼ºåˆ¶åˆ·æ–°ç¼“å­˜
        const APP_VERSION = '20241001';
        
        // ç®€åŒ–ç¯å¢ƒæ£€æµ‹
        const isWeChat = /micromessenger/i.test(navigator.userAgent);
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        
        // å¾®ä¿¡æµè§ˆå™¨æç¤ºåŠŸèƒ½ - åªåœ¨å¾®ä¿¡ä¸­æ˜¾ç¤º
        function initWechatBrowserTip() {
            // åªåœ¨å¾®ä¿¡å†…ç½®æµè§ˆå™¨ä¸­æ˜¾ç¤ºæç¤º
            if (isWeChat) {
                const tipElement = document.getElementById('wechatTip');
                const closeBtn = document.getElementById('closeWechatTip');
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»å…³é—­è¿‡æç¤º
                const tipClosed = localStorage.getItem('wechatTipClosed');
                
                if (!tipClosed && tipElement) {
                    // æ˜¾ç¤ºæç¤ºæ¡†
                    tipElement.style.display = 'block';
                    document.body.classList.add('wechat-tip-visible');
                    
                    // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶
                    if (closeBtn) {
                        closeBtn.addEventListener('click', function() {
                            tipElement.style.display = 'none';
                            document.body.classList.remove('wechat-tip-visible');
                            localStorage.setItem('wechatTipClosed', 'true');
                        });
                    }
                    
                    // 20ç§’åè‡ªåŠ¨å…³é—­æç¤ºï¼ˆå¾®ä¿¡ç”¨æˆ·å¯èƒ½ä¸æ–¹ä¾¿æ“ä½œï¼‰
                    setTimeout(function() {
                        if (tipElement.style.display === 'block') {
                            tipElement.style.display = 'none';
                            document.body.classList.remove('wechat-tip-visible');
                            localStorage.setItem('wechatTipClosed', 'true');
                        }
                    }, 20000);
                }
            }
        }
        
        // å¾®ä¿¡ä¸“ç”¨é”™è¯¯å¤„ç† - å¢å¼ºç‰ˆæœ¬
        if (isWeChat) {
            // æ ‡è®°å¾®ä¿¡æµè§ˆå™¨
            document.body.classList.add('wechat-browser');
            
            // å…¨å±€é”™è¯¯æ•è·
            window.addEventListener('error', function(e) {
                console.error('å¾®ä¿¡ç¯å¢ƒé”™è¯¯:', e);
                // ç¡®ä¿åŠ è½½å™¨éšè—
                const loader = document.getElementById('wechatLoader');
                if (loader) loader.style.display = 'none';
                
                // ç¡®ä¿å†…å®¹å¯è§
                const content = document.querySelector('.content');
                if (content) content.style.opacity = '1';
                
                // æ˜¾ç¤ºé”™è¯¯æç¤º
                showWechatFallback('é¡µé¢åŠ è½½é‡åˆ°é—®é¢˜ï¼Œè¯·é‡è¯•');
            });
            
            // Promiseé”™è¯¯æ•è·
            window.addEventListener('unhandledrejection', function(e) {
                console.warn('å¾®ä¿¡ä¸­Promiseé”™è¯¯:', e.reason);
                // æ˜¾ç¤ºé”™è¯¯æç¤º
                showWechatFallback('é¡µé¢åŠ è½½é‡åˆ°é—®é¢˜ï¼Œè¯·é‡è¯•');
                e.preventDefault();
            });
            
            // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç† - å¾®ä¿¡ç‰¹æ®Šå¤„ç†
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    // é¡µé¢é‡æ–°å¯è§æ—¶æ£€æŸ¥çŠ¶æ€
                    checkPageStatus();
                }
            });
        }
        
        // æ˜¾ç¤ºå¾®ä¿¡åŠ è½½å¤±è´¥æç¤º
        function showWechatFallback(message) {
            const fallback = document.getElementById('wechatFallback');
            if (fallback) {
                fallback.style.display = 'flex';
                if (message) {
                    const msgElement = fallback.querySelector('p:first-of-type');
                    if (msgElement) msgElement.textContent = message;
                }
            }
        }
        
        // æ£€æŸ¥é¡µé¢çŠ¶æ€
        function checkPageStatus() {
            // å¦‚æœé¡µé¢å†…å®¹æœªæ˜¾ç¤ºï¼Œå°è¯•é‡æ–°åˆå§‹åŒ–
            const content = document.querySelector('.content');
            if (content && content.style.opacity === '0') {
                setTimeout(() => {
                    content.style.opacity = '1';
                }, 500);
            }
        }
        
        // ç®€åŒ–ç§»åŠ¨ç«¯ä¼˜åŒ–
        function initMobileOptimizations() {
            if (!isMobile) return;
            
            // é˜²æ­¢åŒå‡»ç¼©æ”¾
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // é˜²æ­¢æ‰‹åŠ¿ç¼©æ”¾
            document.addEventListener('gesturestart', function (event) {
                event.preventDefault();
            });
            
            // iOSæ©¡çš®ç­‹æ•ˆæœä¿®å¤
            if (isIOS) {
                document.body.classList.add('ios-scroll-fix');
                const content = document.querySelector('.content');
                if (content) {
                    content.style.overflow = 'auto';
                    content.style.webkitOverflowScrolling = 'touch';
                }
            }
        }
        
        // ç®€åŒ–å¯¼èˆªåŠŸèƒ½
        function initNavigation() {
            const cards = document.querySelectorAll('.nav-card');
            
            cards.forEach(card => {
                // ç‚¹å‡»äº‹ä»¶
                card.addEventListener('click', function() {
                    handleCardClick(this);
                });
                
                // é”®ç›˜äº‹ä»¶
                card.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        handleCardClick(this);
                    }
                });
                
                // è§¦æ‘¸åé¦ˆ
                card.addEventListener('touchstart', function() {
                    this.style.transform = 'translateY(-2px) scale(0.98)';
                });
                
                card.addEventListener('touchend', function() {
                    this.style.transform = '';
                });
            });
            
            // åˆ·æ–°æŒ‰é’®äº‹ä»¶
            const refreshButton = document.getElementById('refreshButton');
            if (refreshButton) {
                refreshButton.addEventListener('click', function() {
                    window.location.reload();
                });
            }
        }
        
        // å¤„ç†å¡ç‰‡ç‚¹å‡»
        function handleCardClick(card) {
            // é˜²æ­¢å¿«é€Ÿå¤šæ¬¡ç‚¹å‡»
            if (card.getAttribute('data-navigating') === 'true') return;
            card.setAttribute('data-navigating', 'true');
            
            const href = card.getAttribute('data-href');
            if (!href) return;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();
            
            // ç”Ÿæˆå¸¦ç‰ˆæœ¬å·å’Œç¼“å­˜çš„URL
            const url = generateUrl(href);
            
            // å»¶è¿Ÿå¯¼èˆªç¡®ä¿åŠ è½½çŠ¶æ€å¯è§
            setTimeout(() => {
                if (isWeChat) {
                    wechatNavigate(url);
                } else {
                    window.location.href = url;
                }
            }, 100);
        }
        
        // ç”Ÿæˆå¸¦ç¼“å­˜æ§åˆ¶çš„URL
        function generateUrl(path) {
            const separator = path.indexOf('?') > -1 ? '&' : '?';
            return path + separator + 'v=' + APP_VERSION + '&_t=' + Date.now();
        }
        
        // å¾®ä¿¡ä¸“ç”¨å¯¼èˆª - å¢å¼ºç‰ˆæœ¬
        function wechatNavigate(url) {
            try {
                const loader = document.getElementById('wechatLoader');
                if (loader) {
                    loader.style.display = 'flex';
                    // æ›´æ–°åŠ è½½æ–‡æœ¬
                    const loaderText = document.getElementById('loaderText');
                    if (loaderText) {
                        loaderText.textContent = 'æ­£åœ¨è·³è½¬ï¼Œè¯·ç¨å€™...';
                    }
                }
                
                // ä½¿ç”¨æ›´å¯é çš„å¯¼èˆªæ–¹æ³•
                let navigationSuccess = false;
                
                // æ–¹æ³•1: ç›´æ¥è·³è½¬
                setTimeout(() => {
                    if (!navigationSuccess) {
                        try {
                            window.location.href = url;
                            navigationSuccess = true;
                        } catch (e) {
                            console.error('æ–¹æ³•1å¯¼èˆªå¤±è´¥:', e);
                        }
                    }
                }, 300);
                
                // æ–¹æ³•2: å¤‡ç”¨è·³è½¬
                setTimeout(() => {
                    if (!navigationSuccess) {
                        try {
                            window.location.replace(url);
                            navigationSuccess = true;
                        } catch (e) {
                            console.error('æ–¹æ³•2å¯¼èˆªå¤±è´¥:', e);
                        }
                    }
                }, 600);
                
                // æ–¹æ³•3: æœ€ç»ˆå°è¯•
                setTimeout(() => {
                    if (!navigationSuccess) {
                        console.error('æ‰€æœ‰å¯¼èˆªæ–¹æ³•å‡å¤±è´¥');
                        hideLoading();
                        showWechatFallback('è·³è½¬å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ç‚¹å‡»é“¾æ¥');
                        
                        // é‡ç½®å¯¼èˆªçŠ¶æ€
                        document.querySelectorAll('.nav-card').forEach(card => {
                            card.setAttribute('data-navigating', 'false');
                        });
                    }
                }, 3000);
                
            } catch (e) {
                console.error('å¾®ä¿¡å¯¼èˆªå¤±è´¥:', e);
                hideLoading();
                showWechatFallback('è·³è½¬å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ç‚¹å‡»é“¾æ¥');
            }
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            const loader = document.getElementById('wechatLoader');
            if (loader) {
                loader.style.display = 'flex';
                
                // è®¾ç½®è¶…æ—¶è‡ªåŠ¨éšè—ï¼ˆå®‰å…¨æªæ–½ï¼‰
                setTimeout(() => {
                    if (loader.style.display === 'flex') {
                        hideLoading();
                        // é‡ç½®å¯¼èˆªçŠ¶æ€
                        document.querySelectorAll('.nav-card').forEach(card => {
                            card.setAttribute('data-navigating', 'false');
                        });
                    }
                }, 10000);
            }
        }
        
        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            const loader = document.getElementById('wechatLoader');
            if (loader) {
                loader.style.display = 'none';
            }
        }
        
        // ç®€åŒ–èƒŒæ™¯åŠ è½½
        function initBackground() {
            const bg = document.getElementById('background');
            if (!bg) return;
            
            // å¾®ä¿¡ä¸­ä¸åŠ è½½èƒŒæ™¯å›¾
            if (isWeChat) {
                bg.style.display = 'none';
                return;
            }
            
            // ç§»åŠ¨ç«¯ä½¿ç”¨ç®€åŒ–èƒŒæ™¯
            if (isMobile) {
                loadMobileBackground(bg);
            } else {
                loadStandardBackground(bg);
            }
        }
        
        function loadMobileBackground(bg) {
            const img = new Image();
            const bgUrl = 'images/bg-mobile-optimized.jpg?v=' + APP_VERSION;
            
            img.onload = function() {
                bg.style.backgroundImage = 'url("' + img.src + '")';
                bg.classList.add('loaded');
            };
            
            img.onerror = function() {
                bg.style.display = 'none';
            };
            
            img.src = bgUrl;
        }
        
        function loadStandardBackground(bg) {
            const img = new Image();
            const supportsWebP = checkWebPSupport();
            const bgUrl = getBackgroundUrl(supportsWebP);
            
            img.onload = function() {
                bg.style.backgroundImage = 'url("' + img.src + '")';
                bg.classList.add('loaded');
            };
            
            img.onerror = function() {
                bg.style.display = 'none';
            };
            
            img.src = bgUrl;
        }
        
        function checkWebPSupport() {
            try {
                return document.createElement('canvas')
                    .toDataURL('image/webp')
                    .indexOf('data:image/webp') === 0;
            } catch {
                return false;
            }
        }
        
        function getBackgroundUrl(supportsWebP) {
            const base = supportsWebP ? 'images/bg-' : 'images/bg-';
            const ext = supportsWebP ? '.webp' : '.jpg';
            return base + (isMobile ? 'mobile' : 'desktop') + ext + '?v=' + APP_VERSION;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„å¤„ç†
        function initPageLoad() {
            // éšè—åˆå§‹åŠ è½½å™¨
            setTimeout(() => {
                hideLoading();
            }, 1000);
            
            // å¾®ä¿¡ä¸­è®¾ç½®è¶…æ—¶å¤„ç†
            if (isWeChat) {
                setTimeout(() => {
                    const loader = document.getElementById('wechatLoader');
                    if (loader && loader.style.display === 'flex') {
                        const loaderText = document.getElementById('loaderText');
                        if (loaderText) {
                            loaderText.textContent = 'åŠ è½½å®Œæˆ';
                            setTimeout(() => {
                                hideLoading();
                            }, 1000);
                        }
                    }
                }, 5000);
            }
            
            // é¡µé¢åŠ è½½å®Œæˆæ ‡è®°
            setTimeout(() => {
                document.body.setAttribute('data-loaded', 'true');
            }, 500);
        }
        
        // ä¸»åˆå§‹åŒ–å‡½æ•°
        function initApp() {
            initWechatBrowserTip(); // æ–°å¢ï¼šåˆå§‹åŒ–å¾®ä¿¡æµè§ˆå™¨æç¤º
            initMobileOptimizations();
            initNavigation();
            initBackground();
            initPageLoad();
            
            console.log('åº”ç”¨åˆå§‹åŒ–å®Œæˆ - ç‰ˆæœ¬: ' + APP_VERSION);
            console.log('å¾®ä¿¡æµè§ˆå™¨æ£€æµ‹: ' + (isWeChat ? 'æ˜¯' : 'å¦'));
        }
        
        // å®‰å…¨å¯åŠ¨
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                try {
                    initApp();
                } catch (e) {
                    console.error('åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', e);
                    hideLoading();
                    if (isWeChat) {
                        showWechatFallback('é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
                    }
                }
            });
        } else {
            try {
                initApp();
            } catch (e) {
                console.error('åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', e);
                hideLoading();
                if (isWeChat) {
                    showWechatFallback('é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
                }
            }
        }
    </script>
</body>
</html>