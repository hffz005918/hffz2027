<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ================= 网络优化部分开始 ================= -->
    <!-- DNS预取控制 -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    <!-- 多级DNS预解析 -->
    <link rel="dns-prefetch" href="//cdn.hongfang.com">
    <link rel="dns-prefetch" href="//static.hongfang.com">
    <link rel="dns-prefetch" href="//api.hongfang.com">
    
    <!-- 关键域名预连接 -->
    <link rel="preconnect" href="https://cdn.hongfang.com" crossorigin>
    <link rel="preconnect" href="https://api.hongfang.com">
    
    <!-- 差异化资源预加载 -->
    <link rel="preload" href="//cdn.hongfang.com/bg-mobile.jpg" as="image" 
          media="(max-width: 600px)" importance="high">
    <link rel="preload" href="//cdn.hongfang.com/bg-desktop.jpg" as="image"
          media="(min-width: 601px)" importance="high">
    
    <!-- 关键CSS内联 -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", sans-serif;
            height: 100vh;
            position: relative;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }

        .background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('//cdn.hongfang.com/bg-mobile.jpg') no-repeat center/cover;
            background-color: #6a8bad;
            filter: brightness(0.8);
            z-index: -1;
        }

        @media (min-width: 601px) {
            .background {
                background-image: url('//cdn.hongfang.com/bg-desktop.jpg');
            }
        }
        
        /* 其他原有样式保持不变... */
    </style>
    <!-- ================= 网络优化部分结束 ================= -->

    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="x5-page-mode" content="app">
    <meta name="x5-orientation" content="portrait">
    <meta name="renderer" content="webkit">
    <title>员工服务系统</title>
    
    <!-- 非关键CSS异步加载 -->
    <link rel="preload" href="//static.hongfang.com/non-critical.css" as="style" 
          onload="this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="//static.hongfang.com/non-critical.css"></noscript>
</head>
<body>
    <!-- 微信加载状态提示 -->
    <div class="wechat-loader" id="wechatLoader">
        加载中，请稍候...
    </div>

    <div class="background"></div>
    <div class="content">
        <div class="title">
            <h1 style="font-size: 2.5em; margin-bottom: 15px;">员工服务系统</h1>
            <p style="font-size: 1.2em;">欢迎使用宏方纺织服务平台</p>
        </div>
        
        <div class="nav-cards">
            <div class="nav-card" data-href="dorm-rules.html">
                <h2>宿舍管理</h2>
                <p>员工宿舍管理制度</p>
            </div>
            
            <div class="nav-card" data-href="fee-query.html">
                <h2>费用查询</h2>
                <p>电费查询服务</p>
            </div>
        </div>
    </div>

    <!-- 异步加载JS -->
    <script defer src="//static.hongfang.com/main.js"></script>
    
    <script>
        // 网络优化增强代码
        (function() {
            // 1. 网络状态感知
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            const isSlowNetwork = connection ? 
                (connection.effectiveType === 'slow-2g' || connection.saveData === true) : 
                false;
            
            if(isSlowNetwork) {
                document.documentElement.classList.add('save-data');
            }

            // 2. 智能预加载下一页
            const nextPages = [
                '//static.hongfang.com/dorm-rules.html',
                '//static.hongfang.com/fee-query.html'
            ];
            
            if(!isSlowNetwork) {
                nextPages.forEach(url => {
                    const link = document.createElement('link');
                    link.rel = 'prefetch';
                    link.href = url;
                    document.head.appendChild(link);
                });
            }

            // 3. 加载失败监控
            window.addEventListener('error', function(e) {
                if(e.target.tagName === 'IMG') {
                    e.target.style.display = 'none';
                }
            }, true);
        })();

        // 保留原有微信优化代码...
        (function() {
            const loader = document.getElementById('wechatLoader');
            const isWeChat = /micromessenger/i.test(navigator.userAgent);
            
            if (isWeChat) {
                loader.style.display = 'flex';
                
                // 微信JSBridge优化（保持不变）
                function setupWeixinBridge() {
                    try {
                        if (typeof WeixinJSBridge !== 'undefined') {
                            WeixinJSBridge.invoke('setFontSizeCallback', { 'fontSize': 0 });
                            WeixinJSBridge.on('menu:setfont', function() {
                                WeixinJSBridge.invoke('setFontSizeCallback', { 'fontSize': 0 });
                            });
                        }
                    } catch (e) {
                        console.warn('微信JSBridge调用失败:', e);
                    }
                }
                
                if (document.readyState === 'complete') {
                    setupWeixinBridge();
                } else {
                    document.addEventListener('DOMContentLoaded', setupWeixinBridge);
                    document.addEventListener('WeixinJSBridgeReady', setupWeixinBridge);
                }
            }
            
            // 页面加载完成后隐藏加载提示
            window.addEventListener('load', function() {
                setTimeout(function() {
                    loader.style.display = 'none';
                }, 300);
            });
            
            // 卡片点击事件（兼容微信）
            document.querySelectorAll('.nav-card').forEach(card => {
                card.addEventListener('click', function() {
                    const url = this.getAttribute('data-href');
                    if (isWeChat) {
                        loader.style.display = 'flex';
                        setTimeout(() => {
                            window.location.href = url;
                        }, 100);
                    } else {
                        window.location.href = url;
                    }
                });
            });
        })();
    </script>
</body>
</html>
